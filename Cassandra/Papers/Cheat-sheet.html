<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ul.lst-kix_h0gi4r8bx0vf-3{list-style-type:none}.lst-kix_h0gi4r8bx0vf-8>li:before{content:"\0025a0  "}.lst-kix_h6or7kmhf8xe-8>li:before{content:"\0025a0  "}ul.lst-kix_h0gi4r8bx0vf-4{list-style-type:none}.lst-kix_5o0wu0pgqex-3>li:before{content:"\0025cf  "}ul.lst-kix_h0gi4r8bx0vf-5{list-style-type:none}.lst-kix_5o0wu0pgqex-5>li:before{content:"\0025a0  "}ul.lst-kix_h0gi4r8bx0vf-6{list-style-type:none}.lst-kix_5o0wu0pgqex-2>li:before{content:"\0025a0  "}.lst-kix_h6or7kmhf8xe-6>li:before{content:"\0025cf  "}.lst-kix_h6or7kmhf8xe-7>li:before{content:"\0025cb  "}ul.lst-kix_h0gi4r8bx0vf-0{list-style-type:none}ul.lst-kix_h0gi4r8bx0vf-1{list-style-type:none}.lst-kix_h0gi4r8bx0vf-5>li:before{content:"\0025a0  "}.lst-kix_5o0wu0pgqex-6>li:before{content:"\0025cf  "}ul.lst-kix_h0gi4r8bx0vf-2{list-style-type:none}.lst-kix_5o0wu0pgqex-0>li:before{content:"\0025cf  "}.lst-kix_h0gi4r8bx0vf-4>li:before{content:"\0025cb  "}.lst-kix_5o0wu0pgqex-1>li:before{content:"\0025cb  "}.lst-kix_5o0wu0pgqex-7>li:before{content:"\0025cb  "}ul.lst-kix_3n8c81n7th43-8{list-style-type:none}ul.lst-kix_3n8c81n7th43-7{list-style-type:none}ul.lst-kix_3n8c81n7th43-6{list-style-type:none}.lst-kix_5o0wu0pgqex-8>li:before{content:"\0025a0  "}.lst-kix_h0gi4r8bx0vf-3>li:before{content:"\0025cf  "}.lst-kix_h6or7kmhf8xe-1>li:before{content:"\0025cb  "}.lst-kix_h6or7kmhf8xe-2>li:before{content:"\0025a0  "}.lst-kix_h6or7kmhf8xe-3>li:before{content:"\0025cf  "}.lst-kix_h6or7kmhf8xe-4>li:before{content:"\0025cb  "}.lst-kix_h6or7kmhf8xe-5>li:before{content:"\0025a0  "}.lst-kix_h0gi4r8bx0vf-6>li:before{content:"\0025cf  "}.lst-kix_h0gi4r8bx0vf-7>li:before{content:"\0025cb  "}ul.lst-kix_3n8c81n7th43-5{list-style-type:none}.lst-kix_r5oumnydra-8>li:before{content:"\0025a0  "}ul.lst-kix_jggxl8ou8ltq-2{list-style-type:none}ul.lst-kix_3n8c81n7th43-4{list-style-type:none}ul.lst-kix_jggxl8ou8ltq-3{list-style-type:none}ul.lst-kix_3n8c81n7th43-3{list-style-type:none}.lst-kix_r5oumnydra-7>li:before{content:"\0025cb  "}ul.lst-kix_jggxl8ou8ltq-0{list-style-type:none}ul.lst-kix_3n8c81n7th43-2{list-style-type:none}ul.lst-kix_jggxl8ou8ltq-1{list-style-type:none}.lst-kix_h0gi4r8bx0vf-0>li:before{content:"\0025cf  "}.lst-kix_h0gi4r8bx0vf-2>li:before{content:"\0025a0  "}ul.lst-kix_3n8c81n7th43-1{list-style-type:none}ul.lst-kix_jggxl8ou8ltq-6{list-style-type:none}ul.lst-kix_3n8c81n7th43-0{list-style-type:none}ul.lst-kix_jggxl8ou8ltq-7{list-style-type:none}ul.lst-kix_jggxl8ou8ltq-4{list-style-type:none}ul.lst-kix_jggxl8ou8ltq-5{list-style-type:none}.lst-kix_h0gi4r8bx0vf-1>li:before{content:"\0025cb  "}.lst-kix_r5oumnydra-4>li:before{content:"\0025cb  "}.lst-kix_r5oumnydra-5>li:before{content:"\0025a0  "}ul.lst-kix_jggxl8ou8ltq-8{list-style-type:none}.lst-kix_r5oumnydra-6>li:before{content:"\0025cf  "}ul.lst-kix_h0gi4r8bx0vf-7{list-style-type:none}ul.lst-kix_h0gi4r8bx0vf-8{list-style-type:none}ul.lst-kix_h6or7kmhf8xe-1{list-style-type:none}ul.lst-kix_h6or7kmhf8xe-0{list-style-type:none}.lst-kix_h8pwoc1g5o4b-0>li:before{content:"\0025cf  "}.lst-kix_h8pwoc1g5o4b-1>li:before{content:"\0025cb  "}ul.lst-kix_5o0wu0pgqex-8{list-style-type:none}ul.lst-kix_h8pwoc1g5o4b-8{list-style-type:none}ul.lst-kix_h8pwoc1g5o4b-3{list-style-type:none}ul.lst-kix_h8pwoc1g5o4b-2{list-style-type:none}ul.lst-kix_h8pwoc1g5o4b-1{list-style-type:none}ul.lst-kix_h8pwoc1g5o4b-0{list-style-type:none}ul.lst-kix_h8pwoc1g5o4b-7{list-style-type:none}ul.lst-kix_h8pwoc1g5o4b-6{list-style-type:none}ul.lst-kix_h8pwoc1g5o4b-5{list-style-type:none}ul.lst-kix_h8pwoc1g5o4b-4{list-style-type:none}.lst-kix_3n8c81n7th43-6>li:before{content:"\0025cf  "}.lst-kix_3n8c81n7th43-7>li:before{content:"\0025cb  "}.lst-kix_jggxl8ou8ltq-0>li:before{content:"\0025cf  "}.lst-kix_3n8c81n7th43-8>li:before{content:"\0025a0  "}.lst-kix_jggxl8ou8ltq-2>li:before{content:"\0025a0  "}.lst-kix_jggxl8ou8ltq-1>li:before{content:"\0025cb  "}.lst-kix_5o0wu0pgqex-4>li:before{content:"\0025cb  "}.lst-kix_jggxl8ou8ltq-4>li:before{content:"\0025cb  "}.lst-kix_jggxl8ou8ltq-3>li:before{content:"\0025cf  "}.lst-kix_jggxl8ou8ltq-7>li:before{content:"\0025cb  "}.lst-kix_jggxl8ou8ltq-6>li:before{content:"\0025cf  "}.lst-kix_3n8c81n7th43-5>li:before{content:"\0025a0  "}.lst-kix_jggxl8ou8ltq-5>li:before{content:"\0025a0  "}ul.lst-kix_r5oumnydra-3{list-style-type:none}ul.lst-kix_r5oumnydra-4{list-style-type:none}ul.lst-kix_r5oumnydra-1{list-style-type:none}.lst-kix_3n8c81n7th43-4>li:before{content:"\0025cb  "}ul.lst-kix_r5oumnydra-2{list-style-type:none}ul.lst-kix_r5oumnydra-0{list-style-type:none}.lst-kix_3n8c81n7th43-3>li:before{content:"\0025cf  "}.lst-kix_3n8c81n7th43-0>li:before{content:"\0025cf  "}.lst-kix_3n8c81n7th43-2>li:before{content:"\0025a0  "}.lst-kix_jggxl8ou8ltq-8>li:before{content:"\0025a0  "}ul.lst-kix_r5oumnydra-7{list-style-type:none}ul.lst-kix_r5oumnydra-8{list-style-type:none}ul.lst-kix_r5oumnydra-5{list-style-type:none}.lst-kix_3n8c81n7th43-1>li:before{content:"\0025cb  "}ul.lst-kix_r5oumnydra-6{list-style-type:none}.lst-kix_wra57xcfeq2k-2>li:before{content:"\0025a0  "}.lst-kix_wra57xcfeq2k-3>li:before{content:"\0025cf  "}ul.lst-kix_wra57xcfeq2k-0{list-style-type:none}ul.lst-kix_wra57xcfeq2k-1{list-style-type:none}ul.lst-kix_wra57xcfeq2k-2{list-style-type:none}ul.lst-kix_wra57xcfeq2k-3{list-style-type:none}ul.lst-kix_wra57xcfeq2k-4{list-style-type:none}.lst-kix_wra57xcfeq2k-0>li:before{content:"\0025cf  "}ul.lst-kix_wra57xcfeq2k-5{list-style-type:none}.lst-kix_wra57xcfeq2k-8>li:before{content:"\0025a0  "}ul.lst-kix_wra57xcfeq2k-6{list-style-type:none}.lst-kix_wra57xcfeq2k-1>li:before{content:"\0025cb  "}ul.lst-kix_wra57xcfeq2k-7{list-style-type:none}ul.lst-kix_wra57xcfeq2k-8{list-style-type:none}ul.lst-kix_5o0wu0pgqex-2{list-style-type:none}ul.lst-kix_5o0wu0pgqex-3{list-style-type:none}ul.lst-kix_5o0wu0pgqex-0{list-style-type:none}.lst-kix_h8pwoc1g5o4b-6>li:before{content:"\0025cf  "}ul.lst-kix_5o0wu0pgqex-1{list-style-type:none}ul.lst-kix_5o0wu0pgqex-6{list-style-type:none}ul.lst-kix_5o0wu0pgqex-7{list-style-type:none}.lst-kix_wra57xcfeq2k-7>li:before{content:"\0025cb  "}ul.lst-kix_5o0wu0pgqex-4{list-style-type:none}.lst-kix_h8pwoc1g5o4b-5>li:before{content:"\0025a0  "}ul.lst-kix_5o0wu0pgqex-5{list-style-type:none}.lst-kix_wra57xcfeq2k-6>li:before{content:"\0025cf  "}.lst-kix_h8pwoc1g5o4b-2>li:before{content:"\0025a0  "}.lst-kix_h8pwoc1g5o4b-4>li:before{content:"\0025cb  "}.lst-kix_wra57xcfeq2k-4>li:before{content:"\0025cb  "}.lst-kix_wra57xcfeq2k-5>li:before{content:"\0025a0  "}.lst-kix_h8pwoc1g5o4b-3>li:before{content:"\0025cf  "}ul.lst-kix_h6or7kmhf8xe-3{list-style-type:none}.lst-kix_r5oumnydra-0>li:before{content:"\0025cf  "}ul.lst-kix_h6or7kmhf8xe-2{list-style-type:none}ul.lst-kix_h6or7kmhf8xe-5{list-style-type:none}.lst-kix_r5oumnydra-1>li:before{content:"\0025cb  "}ul.lst-kix_h6or7kmhf8xe-4{list-style-type:none}ul.lst-kix_h6or7kmhf8xe-7{list-style-type:none}ul.lst-kix_h6or7kmhf8xe-6{list-style-type:none}ul.lst-kix_h6or7kmhf8xe-8{list-style-type:none}.lst-kix_r5oumnydra-3>li:before{content:"\0025cf  "}.lst-kix_r5oumnydra-2>li:before{content:"\0025a0  "}.lst-kix_h8pwoc1g5o4b-7>li:before{content:"\0025cb  "}.lst-kix_h8pwoc1g5o4b-8>li:before{content:"\0025a0  "}.lst-kix_h6or7kmhf8xe-0>li:before{content:"\0025cf  "}ol{margin:0;padding:0}table td,table th{padding:0}.c3{margin-left:18pt;padding-top:3pt;line-height:1.0}.c9{margin-left:36pt;padding-top:3pt;line-height:1.0}.c0{page-break-after:avoid;orphans:2;widows:2}.c15{background-color:#ffffff;max-width:451.4pt;padding:72pt 72pt 72pt 72pt}.c5{padding:0;margin:0}.c6{font-size:8pt;font-family:"Courier New"}.c7{color:#1155cc;text-decoration:underline}.c2{color:inherit;text-decoration:inherit}.c1{orphans:2;widows:2}.c14{padding-top:10pt;line-height:1.0}.c10{padding-top:4pt;line-height:1.0}.c4{margin-left:36pt;padding-left:0pt}.c8{font-weight:700}.c11{height:11pt}.c12{padding-bottom:4pt}.c13{height:20pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{background-color:#000000;padding-top:0pt;color:#ffffff;font-weight:700;font-size:11pt;padding-bottom:0pt;font-family:"Courier New";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}</style></head><body class="c15"><p class="c0 title" id="h.nmj9vi6f72zs"><span>Cassandra: Cheat-sheet</span></p><p class="c0 subtitle" id="h.elplauh8pzq2"><span>Chris Hoolihan (</span><span class="c7"><a class="c2" href="mailto:chrusty@gmail.com">chrusty@gmail.com</a></span><span>)</span></p><h1 class="c0" id="h.5fblmeo2few9"><span>Contents</span></h1><p class="c1 c10"><span class="c7"><a class="c2" href="#h.5fblmeo2few9">Contents</a></span></p><p class="c1 c14"><span class="c7"><a class="c2" href="#h.8oke2icnyeq1">Introduction</a></span></p><p class="c1 c14"><span class="c7"><a class="c2" href="#h.6vjl1ltfan0z">Terminology &amp; Concepts</a></span></p><p class="c3 c1"><span class="c7"><a class="c2" href="#h.6jw97tu3g3nr">KeySpace</a></span></p><p class="c3 c1"><span class="c7"><a class="c2" href="#h.lpih6h7i8s94">Table / ColumnFamily</a></span></p><p class="c3 c1"><span class="c7"><a class="c2" href="#h.38ajgns4ci0q">Partition</a></span></p><p class="c3 c1"><span class="c7"><a class="c2" href="#h.cubzp151ealg">Row</a></span></p><p class="c3 c1"><span class="c7"><a class="c2" href="#h.40odrizg99r9">Wide-row</a></span></p><p class="c3 c1"><span class="c7"><a class="c2" href="#h.2g0aowgh0lpt">Compaction</a></span></p><p class="c3 c1"><span class="c7"><a class="c2" href="#h.dhs35s1rdgio">Replication-factor / strategy</a></span></p><p class="c3 c1"><span class="c7"><a class="c2" href="#h.hzcs85elnc4s">Tunable-consistency</a></span></p><p class="c3 c1"><span class="c7"><a class="c2" href="#h.jlni5jf961zm">Repair</a></span></p><p class="c3 c1"><span class="c7"><a class="c2" href="#h.ok2l7u4tf6e">Gossip</a></span></p><p class="c1 c3"><span class="c7"><a class="c2" href="#h.27stods1c72w">Hinted Handoff</a></span></p><p class="c3 c1"><span class="c7"><a class="c2" href="#h.6cp85em49spo">SSTable</a></span></p><p class="c1 c14"><span class="c7"><a class="c2" href="#h.h4w2g3b01054">Useful Commands</a></span></p><p class="c3 c1"><span class="c7"><a class="c2" href="#h.s0gzmd3tg7zx">Status</a></span></p><p class="c9 c1"><span class="c7"><a class="c2" href="#h.73uttqm441go">Cluster membership</a></span></p><p class="c9 c1"><span class="c7"><a class="c2" href="#h.9s8qtvsas9i3">Current node status</a></span></p><p class="c9 c1"><span class="c7"><a class="c2" href="#h.5hnalper57cp">Current node version</a></span></p><p class="c9 c1"><span class="c7"><a class="c2" href="#h.8yhgezygxm6v">Cluster versions (according to Gossip)</a></span></p><p class="c3 c1"><span class="c7"><a class="c2" href="#h.2aa1en8fxtat">Operations</a></span></p><p class="c9 c1"><span class="c7"><a class="c2" href="#h.j816xd7vc5w4">Dump the entire schema to a file</a></span></p><p class="c1 c9"><span class="c7"><a class="c2" href="#h.6ktw61cy8t1f">Repair</a></span></p><p class="c9 c1"><span class="c7"><a class="c2" href="#h.n7rigghe45z3">Assassinate the ghost of a dead node</a></span></p><p class="c3 c1"><span class="c7"><a class="c2" href="#h.5sjdkfe8np95">Performance and monitoring</a></span></p><p class="c9 c1"><span class="c7"><a class="c2" href="#h.xejc3fk7ax5v">System-wide threadpool status</a></span></p><p class="c9 c1"><span class="c7"><a class="c2" href="#h.q2t3udiu0g9e">Per-table statistics</a></span></p><p class="c9 c1 c12"><span class="c7"><a class="c2" href="#h.ihguy18hjhmp">Single-table statistics</a></span></p><p class="c1 c11"><span></span></p><hr style="page-break-before:always;display:none;"><h1 class="c0 c13" id="h.trm53vzbmv8v"><span></span></h1><h1 class="c0" id="h.8oke2icnyeq1"><span>Introduction</span></h1><p class="c1"><span>This document is intended to provide a quick reference to some common Cassandra terminology, and some helpful commands.</span></p><h1 class="c0 c13" id="h.djpxwf2pq9j4"><span></span></h1><hr style="page-break-before:always;display:none;"><h1 class="c0 c13" id="h.oy4yozcvb9k4"><span></span></h1><h1 class="c0" id="h.6vjl1ltfan0z"><span>Terminology &amp; Concepts</span></h1><h2 class="c0" id="h.6jw97tu3g3nr"><span>KeySpace</span></h2><p class="c1"><span>A KeySpace is a named collection of tables (analogous to a &ldquo;schema&rdquo; or &ldquo;database&rdquo; in MySQL). Certain defaults are configured on a per-keyspace basic (such as replication settings). KeySpaces are also useful logical security zones when specifying ACLs.</span></p><h2 class="c0" id="h.lpih6h7i8s94"><span>Table / ColumnFamily</span></h2><p class="c1"><span>A table (previously known as a &ldquo;ColumnFamily&rdquo; should be thought of in much the same way as a table in a traditional database. Really it is a definition of an index for a set of similar data-objects with a defined schema.</span></p><h2 class="c0" id="h.38ajgns4ci0q"><span>Partition</span></h2><p class="c1"><span>A &ldquo;partition&rdquo; is a chunk of data addressable in a Cassandra cluster (a key/value pair).</span></p><ul class="c5 lst-kix_5o0wu0pgqex-0 start"><li class="c1 c4"><span>This can appear to be many rows and columns</span></li><li class="c1 c4"><span>A partition is entirely stored on one node (never spills over)</span></li><li class="c1 c4"><span>Rows within a partition can be ordered and sliced</span></li><li class="c1 c4"><span>Data can be modelled using a partition as a mini table</span></li></ul><h2 class="c0" id="h.cubzp151ealg"><span>Row</span></h2><p class="c1"><span>A &ldquo;row&rdquo; is an entry within a partition. It can be thought of as a row in a traditional database. Historically a &ldquo;partition&rdquo; was called a &ldquo;row&rdquo;, and you will still see references to this in some of the documentation. This is confusing, sorry.</span></p><h2 class="c0" id="h.40odrizg99r9"><span>Wide-row</span></h2><p class="c1"><span>The term &ldquo;wide-row&rdquo; is used to describe a data-model which allows rows to grow horizontally. In practise this means that a partition can have an arbitrarily large number of rows.</span></p><h2 class="c0" id="h.2g0aowgh0lpt"><span>Compaction</span></h2><p class="c1"><span>New files appear on disk whenever data is written to Cassandra. To avoid having to read all of these files each time data is queried, Cassandra tries to maintain a smaller number of more-dense files on disk. This process is known as &ldquo;compaction&rdquo;.</span></p><p class="c1 c11"><span></span></p><p class="c1"><span class="c7"><a class="c2" href="https://www.google.com/url?q=http://docs.datastax.com/en/cassandra/2.0/cassandra/dml/dml_write_path_c.html%23concept_ds_wt3_32w_zj__dml-compaction&amp;sa=D&amp;ust=1476784098185000&amp;usg=AFQjCNGXwz5HxVEvogDPXYYmx9cIOIXxfw">Compaction (DataStax)</a></span></p><h2 class="c0" id="h.dhs35s1rdgio"><span>Replication-factor / strategy</span></h2><p class="c1"><span>Cassandra KeySpaces can be configured to replicate data in different ways. This can be quite simple, or involve an amount of locational awareness.</span></p><ul class="c5 lst-kix_3n8c81n7th43-0 start"><li class="c1 c4"><span>&ldquo;</span><span class="c8">SimpleStrategy</span><span>&rdquo; just treats every node in the cluster the same, and attempts to evenly distribute data between them (whilst ensuring that the specified number of replicas is maintained for each partition).</span></li><li class="c1 c4"><span>&ldquo;</span><span class="c8">NetworkTopologyStrategy</span><span>&rdquo; allows you configure multiple-datacentre topologies, and ensure that the desired number of replicas is maintained in each. Cassandra will also attempt to maintain the replicas in as many different logical &ldquo;racks&rdquo; as possible.</span></li></ul><p class="c1 c11"><span></span></p><p class="c1"><span class="c7"><a class="c2" href="https://www.google.com/url?q=http://docs.datastax.com/en/cassandra/2.0/cassandra/architecture/architectureDataDistributeReplication_c.html&amp;sa=D&amp;ust=1476784098188000&amp;usg=AFQjCNHUSgBvM87Pn2X_GWqxBBXU01kFEA">Data replication (DataStax)</a></span></p><h2 class="c0" id="h.hzcs85elnc4s"><span>Tunable-consistency</span></h2><p class="c1"><span>Cassandra allows the user to choose the appropriate consistency-level for each query. Strong consistency queries involve more cluster members, take more time, and will fail if those cluster members are unavailable. Low consistency queries are of course faster, involve fewer nodes, and will allow you to get responses even when nodes are unavailable (according to your replication-strategy).</span></p><p class="c1 c11"><span></span></p><p class="c1"><span>Most people who care about the data they&rsquo;re storing end up using a combination of replication-factor 3, and quorum queries. This allows queries to return even when a node is down, but also guarantees data consistency.</span></p><p class="c1 c11"><span></span></p><p class="c1"><span class="c7"><a class="c2" href="https://www.google.com/url?q=http://docs.datastax.com/en/cassandra/2.0/cassandra/dml/dml_config_consistency_c.html?hl%3Dconsistency&amp;sa=D&amp;ust=1476784098189000&amp;usg=AFQjCNEn6SD7bPGw3MxuV5F61g0W0ihZ7w">Configuring data consistency (DataStax)</a></span></p><h2 class="c0" id="h.jlni5jf961zm"><span>Repair</span></h2><p class="c1"><span>Opportunities for your data to become &ldquo;inconsistent&rdquo; arise during the course of day-to-day operations unless you&rsquo;re using the absolute highest consistency options (and suffering the associated performance and availability issues arising from this). A well-designed application and cluster topology should be able to cope with these scenarios, but Cassandra has the ability to repair its data consistency to match your desired replication settings.</span></p><p class="c1 c11"><span></span></p><p class="c1"><span>A repair is coordinated by one node in the cluster against a certain range of the overall data (or all of it). This effectively asks all of the nodes responsible for this data to analyse what they have on disk and produce checksums for it, then report back to the coordinator node. The coordinator node then compares the results, and asks for any differences to be reconciled.</span></p><p class="c1 c11"><span></span></p><p class="c1"><span>Regular repairs should be scheduled on every cluster (usually once per week).</span></p><p class="c1 c11"><span></span></p><p class="c1"><span class="c7"><a class="c2" href="https://www.google.com/url?q=http://docs.datastax.com/en/cassandra/2.0/cassandra/operations/ops_repair_nodes_c.html?hl%3Drepair&amp;sa=D&amp;ust=1476784098191000&amp;usg=AFQjCNGoZ2iCzFVYMlpMdv69M5hJxKMbSw">Repairing nodes (DataStax)</a></span></p><h2 class="c0" id="h.ok2l7u4tf6e"><span>Gossip</span></h2><p class="c1"><span>Cassandra clusters use a &ldquo;gossip&rdquo; protocol to share status information for things like:</span></p><ul class="c5 lst-kix_h6or7kmhf8xe-0 start"><li class="c1 c4"><span>Membership (new nodes joining)</span></li><li class="c1 c4"><span>Node status (up/down)</span></li><li class="c1 c4"><span>Load (how much data each node has)</span></li></ul><p class="c1 c11"><span></span></p><p class="c1"><span class="c7"><a class="c2" href="https://www.google.com/url?q=http://docs.datastax.com/en/cassandra/2.0/cassandra/architecture/architectureGossipAbout_c.html?hl%3Dgossip&amp;sa=D&amp;ust=1476784098193000&amp;usg=AFQjCNFExHJVVrGI5xLPXZ6HbyTThhQWtw">Internode communications (gossip) (DataStax)</a></span></p><h2 class="c0" id="h.27stods1c72w"><span>Hinted Handoff</span></h2><p class="c1"><span>Cassandra nodes can accept data even if it is not specifically for themselves. In this case a node will figure out which of its peers is responsible for the data and attempt to forward it on. If the node they&rsquo;re trying to talk to is down, then the data will be locally cached and forwarded later on when the node they want is back up. This process is known as &ldquo;hinted handoff&rdquo;.</span></p><p class="c1 c11"><span></span></p><p class="c1"><span class="c7"><a class="c2" href="https://www.google.com/url?q=http://docs.datastax.com/en/cassandra/2.0/cassandra/dml/dml_about_hh_c.html&amp;sa=D&amp;ust=1476784098194000&amp;usg=AFQjCNHL4J3rGRVo7dDnyJFMNibW6Sx1Yw">About hinted handoff writes (DataStax)</a></span></p><h2 class="c0" id="h.6cp85em49spo"><span>SSTable</span></h2><ul class="c5 lst-kix_h8pwoc1g5o4b-0 start"><li class="c1 c4"><span>Cassandra&rsquo;s on-disk data-format (Sorted Strings Table).</span></li><li class="c1 c4"><span>New data is flushed periodically to disk as SSTables.</span></li><li class="c1 c4"><span>SSTables are IMMUTABLE (can&rsquo;t be changed, only deleted).</span></li><li class="c1 c4"><span>Data is ordered (this allows rows in a partition to be ordered).</span></li></ul><p class="c1 c11"><span></span></p><p class="c1"><span class="c7"><a class="c2" href="https://www.google.com/url?q=http://distributeddatastore.blogspot.co.uk/2013/08/cassandra-sstable-storage-format.html&amp;sa=D&amp;ust=1476784098196000&amp;usg=AFQjCNGUITaN0-_71-5TmTxxVcu5jPXk8g">Cassandra SSTable Storage Format (distributeddatastore)</a></span></p><h1 class="c0 c13" id="h.8wbdl3mgwz89"><span></span></h1><hr style="page-break-before:always;display:none;"><h1 class="c0 c13" id="h.jsckjp37yrnl"><span></span></h1><h1 class="c0" id="h.h4w2g3b01054"><span>Useful Commands</span></h1><p class="c1"><span>This section includes a list of some of the most useful commands you may need to work with Cassandra. Most of these are subcommands of the &ldquo;nodetool&rdquo; utility which comes with Cassandra. Nodetool is really just a JMX client - all of these endpoints are available through Cassandra&rsquo;s JMX interface.</span></p><h2 class="c0" id="h.s0gzmd3tg7zx"><span>Status</span></h2><p class="c1"><span>The following commands can be used to find the current status of various aspects of your cluster and nodes.</span></p><h3 class="c0" id="h.73uttqm441go"><span>Cluster membership</span></h3><p class="c1"><span>The &ldquo;</span><span class="c8">nodetool status</span><span>&rdquo; command shows the UP/DOWN status of every node in the cluster, including data volumes. This can be run from any active node in the cluster.</span></p><h3 class="c0" id="h.9s8qtvsas9i3"><span>Current node status</span></h3><p class="c1"><span>The &ldquo;</span><span class="c8">nodetool info</span><span>&rdquo; command returns detailed status information about the node you&rsquo;re currently connected to. Information includes:</span></p><ul class="c5 lst-kix_r5oumnydra-0 start"><li class="c1 c4"><span>Service status</span></li><li class="c1 c4"><span>Data volume</span></li><li class="c1 c4"><span>Memory usage</span></li><li class="c1 c4"><span>Logical location info (rack/DC)</span></li><li class="c1 c4"><span>Exception count</span></li><li class="c1 c4"><span>Cache efficiency</span></li></ul><h3 class="c0" id="h.5hnalper57cp"><span>Current node version</span></h3><p class="c1"><span>The &ldquo;</span><span class="c8">nodetool version</span><span>&rdquo; command returns the version of Cassandra currently installed.</span></p><h3 class="c0" id="h.8yhgezygxm6v"><span>Cluster versions (according to Gossip)</span></h3><p class="c1"><span>The &ldquo;</span><span class="c8">nodetool gossipinfo</span><span>&rdquo; command returns the versions of Cassandra reported by all of the cluster nodes, as well as some other useful info like locations and schema versions. Useful when performing a rolling-upgrade across a cluster.</span></p><h2 class="c0" id="h.2aa1en8fxtat"><span>Operations</span></h2><p class="c1"><span>The following commands will be useful when performing common operational tasks.</span></p><h3 class="c0" id="h.j816xd7vc5w4"><span>Dump the entire schema to a file</span></h3><p class="c1"><span>You can use CQLSH to dump all of the schema definitions to a file:</span></p><p class="c1"><span>&ldquo;</span><span class="c8">echo &#39;DESCRIBE FULL SCHEMA;&#39; |cqlsh &gt;schema.cql</span><span>&rdquo;</span></p><h3 class="c0" id="h.6ktw61cy8t1f"><span>Repair</span></h3><p class="c1"><span>You will sometimes need to trigger a repair on some of your data. </span></p><ul class="c5 lst-kix_wra57xcfeq2k-0 start"><li class="c1 c4"><span>&ldquo;</span><span class="c8">nodetool repair</span><span>&rdquo; will repair all of the data in your cluster</span></li><li class="c1 c4"><span>&ldquo;</span><span class="c8">nodetool repair keyspace1</span><span>&rdquo; will repair only the &ldquo;keyspace1&rdquo; keyspace</span></li><li class="c1 c4"><span>&ldquo;</span><span class="c8">nodetool repair keyspace1 table1</span><span>&rdquo; will repair only the &ldquo;table1&rdquo; table in that keyspace</span></li></ul><p class="c1 c11"><span></span></p><p class="c1"><span>Repairs can take time, so it&rsquo;s best to run these in screen / tmux</span></p><h3 class="c0" id="h.n7rigghe45z3"><span>Assassinate the ghost of a dead node</span></h3><p class="c1"><span>If you ever have to replace one of the nodes in your cluster with a new one, you will find that the &ldquo;nodetool status&rdquo; command still shows the old node in the list as being &ldquo;down&rdquo;. The cluster of course can&rsquo;t know that the old one isn&rsquo;t coming back, so you need manually remove it using the &ldquo;assassinate&rdquo; command (DANGER ZONE).</span></p><ul class="c5 lst-kix_jggxl8ou8ltq-0 start"><li class="c1 c4"><span>&ldquo;</span><span class="c8">nodetool assassinate 10.1.2.3</span><span>&rdquo; will remove any memory of 10.1.2.3 (you should run a repair after doing this).</span></li></ul><h2 class="c0" id="h.5sjdkfe8np95"><span>Performance and monitoring</span></h2><p class="c1"><span>The following commands can be very useful when diagnosing performance-related issues (though you&rsquo;ll need to have some idea which keyspace and table you&rsquo;re looking for).</span></p><h3 class="c0" id="h.xejc3fk7ax5v"><span>System-wide threadpool status</span></h3><p class="c1"><span>The &ldquo;</span><span class="c8">nodetool tpstats</span><span>&rdquo; command shows you some basic stats on some of Cassandra&rsquo;s internal thread-pools. The only real use for this is to make observations along the lines of &ldquo;I can see that a bunch of stuff has been blocked, therefore this node is starved of resources (probably I/O)&rdquo;.</span></p><h3 class="c0" id="h.q2t3udiu0g9e"><span>Per-table statistics</span></h3><p class="c1"><span>The &ldquo;</span><span class="c8">nodetool cfstats</span><span>&rdquo; (or &ldquo;</span><span class="c8">nodetool tablestats</span><span>&rdquo; in more recent versions) command gives you performance statistics for every table in every keyspace. Particularly useful stats are:</span></p><ul class="c5 lst-kix_h0gi4r8bx0vf-0 start"><li class="c1 c4"><span>Average read-latency (high values indicate poor data-access patterns / models)</span></li><li class="c1 c4"><span>Average write-latency (high values would be very rare and suggest very serious resource constraints)</span></li><li class="c1 c4"><span>Partition min/avg/max sizes (useful to see if you have any strangely outlying partition abuse)</span></li><li class="c1 c4"><span>Read &amp; write operation count (know how many queries are being performed)</span></li></ul><h3 class="c0" id="h.ihguy18hjhmp"><span>Single-table statistics</span></h3><p class="c1"><span>This is the most powerful command-line tool for diagnosing performance issues. To be in this position you already know which table is giving you trouble, and you&rsquo;re trying to figure out why.</span></p><p class="c1 c11"><span></span></p><p class="c1"><span>The command &ldquo;</span><span class="c8">nodetool tablehistograms keyspace1 standard1</span><span>&rdquo; (previously &ldquo;</span><span class="c8">cfhistograms</span><span>&rdquo;) gives me a table of stats for the table called &ldquo;</span><span class="c8">standard1</span><span>&rdquo; in the &ldquo;</span><span class="c8">keyspace1</span><span>&rdquo; keyspace (this was created by the stress-test util).</span></p><p class="c1 c11"><span></span></p><p class="c1"><span class="c6">root@ee2b5561ca20:/# nodetool tablehistograms keyspace1 standard1</span></p><p class="c1"><span class="c6">keyspace1/standard1 histograms</span></p><p class="c1"><span class="c6">Percentile &nbsp;SSTables &nbsp; &nbsp; Write Latency &nbsp; &nbsp; &nbsp;Read Latency &nbsp; &nbsp;Partition Size &nbsp; &nbsp; &nbsp; &nbsp;Cell Count</span></p><p class="c1"><span class="c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (micros) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(micros) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (bytes)</span></p><p class="c1"><span class="c6">50% &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 24.60 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 258 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5</span></p><p class="c1"><span class="c6">75% &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 29.52 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 258 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5</span></p><p class="c1"><span class="c6">95% &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 61.21 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 258 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5</span></p><p class="c1"><span class="c6">98% &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;105.78 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 258 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5</span></p><p class="c1"><span class="c6">99% &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;152.32 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 258 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5</span></p><p class="c1"><span class="c6">Min &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8.24 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 216 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5</span></p><p class="c1"><span class="c6">Max &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.00 &nbsp; &nbsp; &nbsp; &nbsp; 155469.30 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 258 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5</span></p><p class="c1 c11"><span></span></p><p class="c1"><span>This output tells me the distribution of read and write query latencies, the distribution of the partition-sizes (and number of &ldquo;rows&rdquo; in each), and the number of files that had to be hit on disk to service the read-queries.</span></p></body></html>